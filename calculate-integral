#!/bin/bash

# Copyright (c) 2018, Gabriel Johnson. All rights reserved.

case $(uname) in
    Linux)
        wolfram=/usr/local/bin/MathKernel
        ccl=ccl/lx86cl64
        ;;
    CYGWIN_NT-*)
        wolfram=("/cygdrive/c/Program Files/Wolfram Research/Mathematica"/*/wolfram)
        ccl=ccl/wx86cl64
        ;;
    Darwin)
        wolfram=/Applications/Mathematica.app/Contents/MacOS/MathKernel
        ccl=ccl/dx86cl64
        ;;
    *)
        echo "$0: Error: Unsupported operating system.">&2
        exit 1
        ;;
esac

test -f "$wolfram" || {
    echo "$0: Error: Mathematica kernel not found.">&2
    exit 1
}

cd $(dirname "${BASH_SOURCE[0]}")

$ccl -I hkm.image $*\
  | "$wolfram" -noprompt\
  | sed -e '1s/^/Hilbert-Kunz Multiplicity	= /' -e '2s/^/F-Signature			= /'

exit ${PIPESTATUS[0]}
